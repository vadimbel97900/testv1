<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–û–ø—Ä–æ—Å ‚Äî –†–µ–∞–±—ñ–ª—ñ—Ç–∞—Ü—ñ—è (—Å—É—á–∞—Å–Ω–∏–π –¥–∏–∑–∞–π–Ω 2025)</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --glass: rgba(255,255,255,0.04);
      --accent-a: linear-gradient(90deg,#44e0b7 0%, #4db6ff 100%);
      --accent-b: linear-gradient(90deg,#ff9bd6 0%, #7a66ff 100%);
      --muted: #a6b0c3;
      --glass-2: rgba(255,255,255,0.02);
      --success: #44e0b7;
      --danger: #ff7a7a;
      --glass-border: rgba(255,255,255,0.06);
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background: radial-gradient(1200px 600px at 10% 10%, rgba(77,182,255,0.06), transparent), radial-gradient(800px 400px at 90% 90%, rgba(122,102,255,0.04), transparent), var(--bg); color:#e6eef8}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:32px}

    .card{
      width:920px;max-width:96vw;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid var(--glass-border);border-radius:18px;padding:28px;backdrop-filter: blur(8px);box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      display:grid;grid-template-columns:320px 1fr;gap:24px;align-items:start;
    }

    /* LEFT - info column */
    .col-info{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.012), transparent);border:1px solid var(--glass-2)}
    .brand{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .logo{width:44px;height:44px;border-radius:10px;background:var(--accent-b);display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}
    h1{font-size:18px;margin:0 0 8px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .progress-wrap{margin-top:22px}
    .progress{height:12px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);border-radius:999px;border:1px solid var(--glass-border);overflow:hidden}
    .progress > i{display:block;height:100%;width:0%;background:var(--accent-a);box-shadow:0 6px 18px rgba(77,182,255,0.08);transition:width .35s ease}
    .progress-meta{display:flex;justify-content:space-between;align-items:center;margin-top:10px;font-size:13px;color:var(--muted)}

    .steps-list{margin-top:18px;display:flex;flex-direction:column;gap:8px}
    .step-item{display:flex;gap:10px;align-items:center}
    .step-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.04)}
    .step-dot.active{background:var(--accent-a)}
    .small{font-size:12px;color:var(--muted)}

    /* RIGHT - form area */
    .form-area{padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));min-height:420px}
    .qtitle{margin:0;font-size:20px;display:flex;align-items:center;gap:12px}
    .qsub{margin:8px 0 18px;color:var(--muted);font-size:13px}

    .control{margin:14px 0}
    .range-wrap{display:flex;gap:18px;align-items:center}
    input[type=range]{-webkit-appearance:none;width:100%;height:10px;border-radius:999px;background:linear-gradient(90deg,#253041, #1b2533);outline:none}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;border-radius:50%;background:var(--accent-b);box-shadow:0 6px 18px rgba(122,102,255,0.12);border:4px solid #081020}

    .value-pill{min-width:56px;padding:8px 10px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid var(--glass-border);text-align:center}

    /* fancy checkboxes */
    .checks{display:flex;flex-direction:column;gap:10px}
    .chk{display:flex;align-items:center;gap:12px;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);cursor:pointer;transition:transform .12s ease,box-shadow .12s ease}
    .chk:hover{transform:translateY(-4px)}
    .chk .circle{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px solid rgba(255,255,255,0.06)}
    .chk.selected{box-shadow: 0 8px 26px rgba(68,224,183,0.06);border:1px solid rgba(68,224,183,0.08)}
    .chk.selected .circle{background:var(--success);border-color:transparent}

    /* image grid */
    .img-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .img-card{padding:10px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.012), transparent);border:1px solid rgba(255,255,255,0.02);display:flex;gap:10px;align-items:center;cursor:pointer}
    .img-card img{width:56px;height:56px;object-fit:cover;border-radius:8px}
    .img-card .ic-title{font-size:14px}
    .img-card.selected{outline:3px solid rgba(77,182,255,0.12);box-shadow:0 10px 30px rgba(13,31,55,0.6);transform:translateY(-6px)}

    textarea, input[type=text]{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;resize:vertical;font-size:14px}
    .muted-note{font-size:12px;color:var(--muted);margin-top:8px}

    .controls-bottom{display:flex;justify-content:space-between;align-items:center;margin-top:20px}
    .btn{padding:10px 16px;border-radius:12px;border:0;background:linear-gradient(90deg,#111827, #0b1220);color:#e6eef8;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
    .btn.primary{background:var(--accent-a);border:0;color:#071725}
    .btn.primary:disabled{opacity:.5;cursor:not-allowed}

    .footer-mini{font-size:12px;color:var(--muted);text-align:center;margin-top:12px}

    @media (max-width:900px){
      .card{grid-template-columns:1fr;}
      .col-info{order:2}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-labelledby="surveyTitle">
      <div class="col-info">
        <div class="brand">
          <div class="logo">R</div>
          <div>
            <h1 id="surveyTitle">–†–µ–∞–±—ñ–ª—ñ—Ç–∞—Ü—ñ–π–Ω–∞ –∞–Ω–∫–µ—Ç–∞</h1>
            <p class="lead">–ö–æ—Ä–æ—Ç–∫–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è ‚Äî —â–æ–± –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—É –ø—Ä–æ–≥—Ä–∞–º—É</p>
          </div>
        </div>

        <div class="progress-wrap">
          <div class="progress" aria-hidden="true"><i id="progressBar"></i></div>
          <div class="progress-meta"><span id="progressText">–ö—Ä–æ–∫ 1 –∑ 7</span><span id="progressPercent">0%</span></div>
        </div>

        <div class="steps-list" id="stepsList">
          <!-- generated -->
        </div>

        <p class="muted-note">–í—ñ–¥–ø–æ–≤—ñ–¥–∞—é—á–∏ ‚Äî –≤–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î—Ç–µ, —â–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—Ä–æ–≥—Ä–∞–º–∏. –ù—ñ—è–∫–∏—Ö —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏—Ö —Ä—ñ—à–µ–Ω—å ‚Äî —Ç—ñ–ª—å–∫–∏ –ø—ñ–¥ –≤–∞—Å.</p>
      </div>

      <div class="form-area" id="formArea">
        <!-- Questions will render here -->
      </div>

    </div>
  </div>

  <script>
    // --- Survey definition (translations as provided) ---
    const steps = [
      {
        id: 'age',
        title: '–Ø–∫–∏–π —É –≤–∞—Å –≤—ñ–∫?',
        subtitle: 'üìç –í—ñ–∫ –≤–∞–∂–ª–∏–≤–∏–π –¥–ª—è –≤–∏–±–æ—Ä—É —ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –ø—ñ–¥—Ö–æ–¥—É',
        type: 'age'
      },
      {
        id: 'diagnosis',
        title: '–ß–∏ —î —É –≤–∞—Å –¥—ñ–∞–≥–Ω–æ—Å—Ç–æ–≤–∞–Ω–∏–π —Å—Ç–∞–Ω –∞–±–æ –Ω–µ—â–æ–¥–∞–≤–Ω—è —Ç—Ä–∞–≤–º–∞?',
        subtitle: '–ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —Ä–µ–∞–±—ñ–ª—ñ—Ç–∞—Ü—ñ–π–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –ø—ñ—Å–ª—è —Ç—Ä–∞–≤–º, –æ–ø–µ—Ä–∞—Ü—ñ–π —á–∏ –±–æ–ª—é –≤ —Å–ø–∏–Ω—ñ. –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ –æ–≥–ª—è–¥—É —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—ó –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏',
        type: 'checkboxes',
        options:[
          '–¢–∞–∫, –±—É–≤/-–ª–∞ —Ç—Ä–∞–≤–º–∞ (—Ä–æ–∑—Ä–∏–≤, –≤–∏–≤–∏—Ö, –ø–µ—Ä–µ–ª–æ–º)',
          '–¢–∞–∫, —Ö—Ä–æ–Ω—ñ—á–Ω–µ –∑–∞—Ö–≤–æ—Ä—é–≤–∞–Ω–Ω—è (–∞—Ä—Ç—Ä–æ–∑, —Å–∫–æ–ª—ñ–æ–∑, –≥—Ä–∏–∂i)',
          '–ù—ñ, –∞–ª–µ —î –±—ñ–ª—å/–¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç',
          '–ü—ñ—Å–ª—è –æ–ø–µ—Ä–∞—Ü—ñ—ó'
        ]
      },
      {
        id: 'where',
        title: '–î–µ —Å–∞–º–µ –≤–∏ –≤—ñ–¥—á—É–≤–∞—î—Ç–µ –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç?',
        subtitle: '–†—É—Ö–æ–≤–∞ —Ç–µ—Ä–∞–ø—ñ—è, –º–∞–Ω—É–∞–ª—å–Ω—ñ —Ç–µ—Ö–Ω—ñ–∫–∏, —Ç–µ–π–ø—É–≤–∞–Ω–Ω—è ‚Äî –≤—Å–µ –≤ –æ–¥–Ω–æ–º—É —Ü–µ–Ω—Ç—Ä—ñ',
        type: 'images',
        options:[
          {img:'1.png',label:'–®–∏—è'},
          {img:'2.png',label:'–°–ø–∏–Ω–∞ (–≥—Ä—É–¥. –∞–±–æ –ø–æ–ø–µ—Ä–µ–∫–æ–≤–∏–π –≤—ñ–¥–¥.)'},
          {img:'3.png',label:'–ö–æ–ª—ñ–Ω–æ'},
          {img:'4.png',label:'–ü–ª–µ—á—ñ'},
          {img:'5.png',label:'–ì–æ–ª–µ–Ω–æ—Å—Ç–æ–ø / —Å—Ç–æ–ø–∏'},
          {img:'6.png',label:'–í—Å–µ —Ç—ñ–ª–æ'}
        ]
      },
      {
        id: 'pain',
        title: '–ù–∞—Å–∫—ñ–ª—å–∫–∏ —ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∏–º —î –±—ñ–ª—å/–¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç –∑–∞—Ä–∞–∑?',
        subtitle: '–ë—ñ–≥—É–Ω–æ–∫: –≤—ñ–¥ 0 (–Ω–µ–º–∞—î –±–æ–ª—é) –¥–æ 10 (–Ω–µ—Å—Ç–µ—Ä–ø–Ω–æ)',
        type: 'scale',
        min:0,max:10
      },
      {
        id: 'goal',
        title: '–Ø–∫–∞ –≤–∞—à–∞ –æ—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞?',
        subtitle: '–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –∑–º–µ–Ω—à–∏—Ç–∏ –±—ñ–ª—å, –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Ä—É—Ö–ª–∏–≤—ñ—Å—Ç—å, –ø–æ—á–∞—Ç–∏ –∑–∞–π–º–∞—Ç–∏—Å—å —Å–ø–æ—Ä—Ç–æ–º, –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏—Å—å –¥–æ –æ–ø–µ—Ä–∞—Ü—ñ—ó —Ç–æ—â–æ',
        type: 'textarea',
        placeholder:'–í–ø–∏—à–∏ —Ç—É—Ç'
      },
      {
        id: 'limits',
        title: '–ß–∏ —î —É –≤–∞—Å –º–µ–¥–∏—á–Ω—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è / –¥—ñ–∞–≥–Ω–æ–∑–∏, –ø—Ä–æ —è–∫—ñ –º–∏ –º–∞—î–º–æ –∑–Ω–∞—Ç–∏?',
        subtitle: '–ñ–æ–¥–Ω–æ—ó ‚Äú—É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ—ó‚Äù –ø—Ä–æ–≥—Ä–∞–º–∏ ‚Äî —Ç—ñ–ª—å–∫–∏ —Ç–µ, —â–æ –ø—Ä–∞—Ü—é—î –¥–ª—è –≤–∞—Å',
        type: 'textarea',
        placeholder:'–í—ñ–ª—å–Ω–µ –ø–æ–ª–µ –≤–≤–æ–¥—É'
      },
      {
        id: 'format',
        title: '–£ —è–∫–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ –≤–∞–º –∑—Ä—É—á–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ —Ä–µ–∞–±—ñ–ª—ñ—Ç–∞—Ü—ñ—é?',
        subtitle: '–ì–Ω—É—á–∫–∏–π –≥—Ä–∞—Ñ—ñ–∫ —Ç–∞ —Ñ–æ—Ä–º–∞—Ç –∑–∞–Ω—è—Ç—å ‚Äî –æ–±–∏—Ä–∞—î—Ç–µ –≤–∏',
        type: 'checkboxes',
        options:[
          '–û—Ñ–ª–∞–π–Ω —É –∫–ª—ñ–Ω—ñ—Ü—ñ',
          '–û–Ω–ª–∞–π–Ω –∑ —Ç—Ä–µ–Ω–µ—Ä–æ–º',
          '–ì—ñ–±—Ä–∏–¥–Ω–æ (—á–∞—Å—Ç–∏–Ω–∞ –∑–∞–Ω—è—Ç—å –≤–¥–æ–º–∞, —á–∞—Å—Ç–∏–Ω–∞ —É —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞)'
        ]
      }
    ];

    const total = steps.length;
    let current = 0;
    const answers = {};

    const formArea = document.getElementById('formArea');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const progressPercent = document.getElementById('progressPercent');
    const stepsList = document.getElementById('stepsList');

    // render steps list
    steps.forEach((s, i)=>{
      const el = document.createElement('div');el.className='step-item';
      el.innerHTML = `<div class='step-dot' id='dot-${s.id}'></div><div><div style='font-size:13px'>–ö—Ä–æ–∫ ${i+1}</div><div class='small'>${s.title}</div></div>`;
      stepsList.appendChild(el);
    });

    function render(){
      const step = steps[current];
      // update progress
      const pct = Math.round((current/ (total)) * 100);
      progressBar.style.width = pct + '%';
      progressText.textContent = `–ö—Ä–æ–∫ ${current+1} –∑ ${total}`;
      progressPercent.textContent = pct + '%';
      // update dots
      steps.forEach((s,i)=>{
        const d = document.getElementById('dot-'+s.id);
        if(!d) return;
        d.classList.toggle('active', i<=current);
      });

      // render question
      formArea.innerHTML = '';
      const qwrap = document.createElement('div');
      qwrap.innerHTML = `<h2 class='qtitle'>${step.title}</h2><div class='qsub'>${step.subtitle||''}</div>`;

      // container for inputs
      const cont = document.createElement('div');cont.className='qcontrols';

      // produce controls based on type
      if(step.type==='age'){
        const wrapper = document.createElement('div');wrapper.className='control';
        wrapper.innerHTML = `
          <div class='range-wrap'>
            <div style='flex:1'>
              <input id='ageRange' type='range' min='12' max='99' value='35' step='1' aria-label='–í—ñ–∫'>
              <div style='display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px'><span>12</span><span>99</span></div>
            </div>
            <div class='value-pill' id='ageVal'>35</div>
          </div>
        `;
        cont.appendChild(wrapper);
      } else if(step.type==='checkboxes'){
        const wrapper = document.createElement('div');wrapper.className='control checks';
        step.options.forEach((opt, idx)=>{
          const ch = document.createElement('label');ch.className='chk';ch.setAttribute('tabindex','0');ch.innerHTML = `<div class='circle'></div><div>${opt}</div>`;
          ch.addEventListener('click',()=>{
            // toggle selection
            ch.classList.toggle('selected');
            updateNextState();
          });
          ch.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();ch.click();}})
          wrapper.appendChild(ch);
        });
        cont.appendChild(wrapper);
      } else if(step.type==='images'){
        const wrapper = document.createElement('div');wrapper.className='control img-grid';
        step.options.forEach((opt)=>{
          const card = document.createElement('div');card.className='img-card';
          card.innerHTML = `<img src='${opt.img}' alt='${opt.label}' onerror="this.style.opacity=.35;this.nextElementSibling.style.opacity=.6"><div><div class='ic-title'>${opt.label}</div></div>`;
          card.addEventListener('click',()=>{card.classList.toggle('selected'); updateNextState();});
          card.setAttribute('tabindex','0');
          card.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();card.click();}})
          wrapper.appendChild(card);
        });
        cont.appendChild(wrapper);
      } else if(step.type==='scale'){
        const wrapper = document.createElement('div');wrapper.className='control';
        wrapper.innerHTML = `
          <div style='display:flex;gap:12px;align-items:center'>
            <div style='flex:1'>
              <input id='painRange' type='range' min='${step.min}' max='${step.max}' value='0' step='1'>
              <div style='display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px'><span>0</span><span>10</span></div>
            </div>
            <div class='value-pill' id='painVal'>0</div>
          </div>
        `;
        cont.appendChild(wrapper);
      } else if(step.type==='textarea'){
        const wrapper = document.createElement('div');wrapper.className='control';
        wrapper.innerHTML = `<textarea id='ta' rows='5' placeholder='${step.placeholder||''}'></textarea><div class='muted-note'>${step.placeholder?'':' '}</div>`;
        cont.appendChild(wrapper);
      }

      // bottom navigation
      const nav = document.createElement('div');nav.className='controls-bottom';
      nav.innerHTML = `
        <div>
          <button class='btn ghost' id='backBtn' ${current===0?"disabled":''}>‚¨Ö –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è</button>
        </div>
        <div style='display:flex;gap:10px;align-items:center'>
          <button class='btn' id='saveBtn' style='display:none'>–ó–±–µ—Ä–µ–≥—Ç–∏</button>
          <button class='btn primary' id='nextBtn' disabled>–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ ‚ûú</button>
        </div>
      `;

      formArea.appendChild(qwrap);formArea.appendChild(cont);formArea.appendChild(nav);

      // add listeners after DOM placed
      setTimeout(()=>{
        // Age slider
        const ageRange = document.getElementById('ageRange');
        if(ageRange){
          const val = document.getElementById('ageVal');
          val.textContent = ageRange.value;
          ageRange.addEventListener('input',()=>{val.textContent = ageRange.value; answers.age = ageRange.value; updateNextState();});
          // initial
          answers.age = ageRange.value;
        }
        // checkboxes
        if(step.type==='checkboxes'){
          // nothing to do here besides next state
        }
        // images
        if(step.type==='images'){
          // nothing extra
        }
        // scale
        const painRange = document.getElementById('painRange');
        if(painRange){
          const pval = document.getElementById('painVal');
          pval.textContent = painRange.value;
          painRange.addEventListener('input',()=>{pval.textContent = painRange.value; answers.pain = painRange.value; updateNextState();});
          answers.pain = painRange.value;
        }
        // textarea
        const ta = document.getElementById('ta');
        if(ta){
          // for both goal and limits
          ta.addEventListener('input',()=>{ answers[step.id]=ta.value.trim(); updateNextState();});
          answers[step.id] = ta.value.trim();
        }
        // back and next
        document.getElementById('backBtn').addEventListener('click',()=>{ if(current>0){current--; render();}})
        document.getElementById('nextBtn').addEventListener('click',()=>{ if(!validateCurrent()) return; collectCurrent(); if(current<total-1){current++; render();} else { finish(); } });

        updateNextState();
      },50);
    }

    function collectCurrent(){
      const step = steps[current];
      if(step.type==='age'){
        answers.age = document.getElementById('ageRange').value;
      } else if(step.type==='checkboxes'){
        const selected = Array.from(document.querySelectorAll('.chk.selected')).map(n=>n.innerText.trim());
        answers[step.id] = selected;
      } else if(step.type==='images'){
        const selected = Array.from(document.querySelectorAll('.img-card.selected')).map(n=>n.querySelector('.ic-title').innerText.trim());
        answers.where = selected;
      } else if(step.type==='scale'){
        answers.pain = document.getElementById('painRange').value;
      } else if(step.type==='textarea'){
        const ta = document.getElementById('ta'); answers[step.id]=ta?ta.value.trim():'';
      }
    }

    function validateCurrent(){
      const step = steps[current];
      if(step.type==='checkboxes'){
        const selected = document.querySelectorAll('.chk.selected').length;
        if(selected===0){alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –≤–∞—Ä—ñ–∞–Ω—Ç.');return false}
      }
      if(step.type==='images'){
        const selected = document.querySelectorAll('.img-card.selected').length;
        if(selected===0){alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∫–∞–∂—ñ—Ç—å –º—ñ—Å—Ü–µ –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç—É.');return false}
      }
      if(step.type==='textarea'){
        const ta = document.getElementById('ta');
        // allow empty for limits; but for goal require something
        if(step.id==='goal' && (!ta || ta.value.trim().length<3)){alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–ø–∏—à—ñ—Ç—å –≤–∞—à—É –æ—Å–Ω–æ–≤–Ω—É –º–µ—Ç—É –º—ñ–Ω—ñ–º—É–º 3 —Å–∏–º–≤–æ–ª–∏.');return false}
      }
      return true;
    }

    function updateNextState(){
      const step = steps[current];
      const nextBtn = document.getElementById('nextBtn');
      let ok = false;
      if(step.type==='age') ok = true; // slider always has value
      else if(step.type==='checkboxes') ok = document.querySelectorAll('.chk.selected').length>0;
      else if(step.type==='images') ok = document.querySelectorAll('.img-card.selected').length>0;
      else if(step.type==='scale') ok = true;
      else if(step.type==='textarea'){
        const ta = document.getElementById('ta');
        if(step.id==='goal') ok = ta && ta.value.trim().length>2; else ok = true; // limits can be empty
      }
      if(nextBtn) nextBtn.disabled = !ok;
    }

    function finish(){
      // collect last
      collectCurrent();
      // small success view
      formArea.innerHTML = `<div style='text-align:center;padding:46px'><h2 style='margin:0 0 6px'>–î—è–∫—É—î–º–æ! ‚úÖ</h2><p class='qsub'>–ú–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –≤–∞—à—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ. –ù–∞—à —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –¥–ª—è –ø–æ–¥–∞–ª—å—à–∏—Ö –∫—Ä–æ–∫—ñ–≤.</p><pre style='text-align:left;background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;margin-top:18px;max-height:220px;overflow:auto'>${JSON.stringify(answers,null,2)}</pre><div style='margin-top:18px'><button class='btn primary' id='restart'>–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —â–µ —Ä–∞–∑</button></div></div>`;
      document.getElementById('restart').addEventListener('click',()=>{ location.reload(); });
    }

    // initial render
    render();
  </script>
</body>
</html>